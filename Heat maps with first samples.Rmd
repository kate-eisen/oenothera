---
title: "Oenothera correlation heatmaps: first flowers only"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## In this file:

I show a number of correlation heat maps for sets of variables overall, and broken out by population. These were made using only the first flower measured per plant. In some cases, a plant may no longer be represented in the morphology dataset or the morphology + scent dataset if one or more morphological variables were not measured on the first flower. I provide the sample sizes at the beginning of each section.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# need the relevant code from test script in order to be able to knit this file

library(tidyverse)
library(readxl)
library(lme4)
library(lmerTest)
library(emmeans)
library(vegan)
library(knitr)
library(reshape2)
library(ggpubr)

file1<-readxl::read_excel("Scent_Full.xlsx", na="0")
file1<-file1 %>% mutate_all(~replace(.,is.na(.), 0))

file2<-readxl::read_excel("Scent_Meta.xlsx")

file3<-readxl::read_excel("Morph_Full.xlsx")

Totals<-file1 %>% 
  bind_rows(summarise_all(., list(~if(is.numeric(.)) sum(.) else "Comp.Total"))) %>% 
  pivot_longer(cols=starts_with("Samp."),names_to="Sample_ID") %>% 
  pivot_wider(names_from=Compounds, values_from = value)

percent <- function(x) { round((x/sum(x)) * 100, digits=3)
}

Percents<-file1 %>% 
  mutate_at(vars(starts_with("Samp.")), percent)

Percents_wide <- Percents %>% 
  pivot_longer(cols=starts_with("Samp."),names_to="Sample_ID") %>% 
  pivot_wider(names_from=Compounds, values_from = value) %>% 
  full_join(file2)

T_S<-function(Column, Tol.Area, Tol.Amt, Samp.Vol) {
  Column/Tol.Area*Tol.Amt*Samp.Vol
} 

ER_Fm<-function(Total.Samp, Hrs, Fr.Mass) {
  Total.Samp/Hrs/Fr.Mass
}

Total_Samples<-Totals %>%  full_join(file2) %>% 
  mutate_at(vars(starts_with("Comp.")), list(~T_S(.,Toluene_Area,Toluene_Amt, Sample_Vol))) 

ER_f_mass<-Total_Samples %>% 
  mutate_at(vars(starts_with("Comp.")), list(~ER_Fm(.,No_Hours, Fresh_Mass))) 

get_upper_tri <- function(cormat){
    cormat[lower.tri(cormat)]<- NA
    return(cormat)
  }

```

### Heatmaps of correlations of scent by compound

Now these are just based on the first sample from each plant. As a result, the sample sizes are fairly low for some populations

Population | *N*
---------- | ---
Total | 76
Arizona | 26
Idaho | 5
Inyo | 15
Logan | 21
Zion | 9

*These visualizations are a bit challenging* because there are 40 compounds, so packing the labels onto the plot makes it hard to read. Blank rows in the figures indicate that the population did not have that compound. Here are the compounds that correspond to each number in the figures below:

[]()      |           
--------- | ---------
1. 2methylbutyronitrile | 21. neral        
2. 3methylbutyronitrile | 22. alpha-terpineol           
3. b-myrcene | 23. Z-E-alpha-farnesene         
4. cis-b-ocimene | 24.  geranial               
5. trans-b-ocimene | 25. cis-pyranoid-linalool-oxide
6. nitro-2-methyl-butane | 26. E-E-alpha-farnesene 
7. nitro-3-methyl-butane | 27. citronellol
8. trans-isobutyraldoxime | 28. trans-pyranoid-linalool-oxide
9. cis-isobutyraldoxime | 29. nerol
10. cis-furanoid-linalool-oxide | 30. geraniol 
11. trans-furanoid-linalool-oxide | 31. 2methylbutyl-benzoate
12. pyran-lin-oxide-ketone | 32. 2phenylethanol       
13. trans-2-methylbutyraldoxime | 33. phenylacetonitrile
14. trans-3-methylbutyraldoxime | 34. farnesene-epoxide
15. cis-2-methylbutyraldoxime | 35. caryophyllene-oxide
16. cis-3-methylbutyraldoxime | 36. nerolidol
17. linalool | 37. nitrophenylethane                        
18. beta-caryophyllene | 38. phenylacetaldoxime           
19. beta-farnesene | 39. isophytol               
20. alpha-humulene | 40. farnesol                
                                                                      
```{r, echo=FALSE, warning=FALSE, message=FALSE}
Arizona <- ER_f_mass %>% filter(Population=="Arizona" & Type=="Yes") %>%  select(starts_with("Comp.")) %>% select(-Comp.Total)
Zion <- ER_f_mass %>% filter(Population=="Zion" & Type=="Yes") %>%  select(starts_with("Comp.")) %>% select(-Comp.Total)
Inyo <- ER_f_mass %>% filter(Population=="Inyo" & Type=="Yes") %>%  select(starts_with("Comp.")) %>% select(-Comp.Total)
Logan <- ER_f_mass %>% filter(Population=="Logan" & Type=="Yes") %>%  select(starts_with("Comp.")) %>% select(-Comp.Total)
Idaho <- ER_f_mass %>% filter(Population=="Idaho" & Type=="Yes") %>%  select(starts_with("Comp.")) %>% select(-Comp.Total)

Tol_ord <- ER_f_mass %>% filter(Type=="Yes") %>% 
  select(starts_with("Comp."), Population) %>% filter_if(is.numeric, any_vars(. != 0)) %>% select(starts_with("Comp.")) %>% select(-Comp.Total)
```

#### All data: 
``` {r, echo=FALSE, warning=FALSE, message=FALSE}
cormat.all <- round(cor(Tol_ord),2)
melted_cormat.all <- melt(cormat.all)
upper_tri.all <- get_upper_tri(cormat.all)
# Melt the correlation matrix
melted_cormat.all <- melt(upper_tri.all, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.all <- ggplot(melted_cormat.all, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 coord_fixed()+scale_x_discrete(labels=c(1:40))+scale_y_discrete(labels=c(1:40))+
ggtitle("All data") +xlab("") +ylab("") + theme(legend.position="bottom") +
  theme(aspect.ratio=2/3)
  
ggheatmap.all
```

#### Arizona
``` {r, echo=FALSE, warning=FALSE, message=FALSE}
cormat.AZ <- round(cor(Arizona),2)
melted_cormat.AZ <- melt(cormat.AZ)
upper_tri.AZ <- get_upper_tri(cormat.AZ)
# Melt the correlation matrix
melted_cormat.AZ <- melt(upper_tri.AZ, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.AZ <- ggplot(melted_cormat.AZ, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 coord_fixed()+scale_x_discrete(labels=c(1:40))+scale_y_discrete(labels=c(1:40))+
ggtitle("Arizona") +xlab("") +ylab("") + theme(legend.position="bottom") +
  theme(aspect.ratio=2/3)
ggheatmap.AZ
```

#### Zion
``` {r, echo=FALSE, warning=FALSE, message=FALSE}
cormat.ZI <- round(cor(Zion),2)
melted_cormat.ZI <- melt(cormat.ZI)
upper_tri.ZI <- get_upper_tri(cormat.ZI)
# Melt the correlation matrix
melted_cormat.ZI <- melt(upper_tri.ZI, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.ZI <- ggplot(melted_cormat.ZI, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 coord_fixed()+scale_x_discrete(labels=c(1:40))+scale_y_discrete(labels=c(1:40))+
ggtitle("Zion") +xlab("") +ylab("") + theme(legend.position="bottom") +
  theme(aspect.ratio=2/3)
ggheatmap.ZI
```

#### Inyo
``` {r, echo=FALSE, warning=FALSE, message=FALSE}
cormat.IN <- round(cor(Inyo),2)
melted_cormat.IN <- melt(cormat.IN)
upper_tri.IN <- get_upper_tri(cormat.IN)
# Melt the correlation matrix
melted_cormat.IN <- melt(upper_tri.IN, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.IN <- ggplot(melted_cormat.IN, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 coord_fixed()+scale_x_discrete(labels=c(1:40))+scale_y_discrete(labels=c(1:40))+
ggtitle("Inyo") +xlab("") +ylab("") + theme(legend.position="bottom") +
  theme(aspect.ratio=2/3)
ggheatmap.IN
```

#### Logan
``` {r, echo=FALSE, warning=FALSE, message=FALSE}
cormat.LO <- round(cor(Logan),2)
melted_cormat.LO <- melt(cormat.LO)
upper_tri.LO <- get_upper_tri(cormat.LO)
# Melt the correlation matrix
melted_cormat.LO <- melt(upper_tri.LO, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.LO <- ggplot(melted_cormat.LO, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 coord_fixed()+scale_x_discrete(labels=c(1:40))+scale_y_discrete(labels=c(1:40))+
ggtitle("Logan") +xlab("") +ylab("") + theme(legend.position="bottom") +
  theme(aspect.ratio=2/3)
ggheatmap.LO 
```

#### Idaho
``` {r, echo=FALSE, warning=FALSE, message=FALSE}
cormat.ID <- round(cor(Idaho),2)
melted_cormat.ID <- melt(cormat.ID)
upper_tri.ID <- get_upper_tri(cormat.ID)
# Melt the correlation matrix
melted_cormat.ID <- melt(upper_tri.ID, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.ID <- ggplot(melted_cormat.ID, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 coord_fixed()+scale_x_discrete(labels=c(1:40))+scale_y_discrete(labels=c(1:40))+
ggtitle("Idaho") +xlab("") +ylab("") + theme(legend.position="bottom") +
  theme(aspect.ratio=2/3)
ggheatmap.ID
```


### Heatmaps of correlations of scent by compound group

Sample sizes are the same as for the heatmaps above of all 40 compounds:

Population | *N*
---------- | ---
Total | 76
Arizona | 26
Idaho | 5
Inyo | 15
Logan | 21
Zion | 9

These are the groupings of the compounds:

| Code | Compounds
| :--- | :--------
| G.ILE | 2 methylbuyronitrile, nitro-2-methyl butane, cis-2-methylbutyraldoxime, trans-2-methylbutyraldoxime, 2methylbutyl benzoate
| G.LEU | 3methylbutyronitrile, nitro-3-methyl-butane, cis-3-methylbutyraldoxime, trans-3-methylbutyraldoxime
| G.VAL | cis-isobutyraldoxime, trans-isobutyraldoxime
| G.PHE | 2phenylethanol, phenylacetonitrile, nitrophenylethane, phenylacetaldoxime
| G.OCI | b-myrcene, cis-b-ocimene, trans-b-ocimene, alpha-terpineol
| G.GER | citronellol, neral, geranial, nerol, geraniol
| G.LIN | linalool, cis-furanoid-linalool-oxide, trans-furanoid-linalool-oxide, pyran-lin-oxide-ketone, cis-pyranoid-linalool-oxide, trans-pyranoid-linalool-oxide
| G.CAR | beta-caryophyllene, alpha-humulene, caryophyllene-oxide
| G.SES | beta-farnesene, Z-E-alpha-farnesene, E-E-alpha-farnesene, farnesene-epoxide, farnesol, nerolidol, isophytol

```{r, echo=FALSE, warning=FALSE, message=FALSE}


ER_f_mass_groups <- ER_f_mass %>% mutate(G.ILE=Comp.2methylbutyronitrile+`Comp.nitro-2-methyl-butane`+`Comp.cis-2-methylbutyraldoxime`+`Comp.trans-2-methylbutyraldoxime`+`Comp.2methylbutyl-benzoate`,
                                         G.LEU=Comp.3methylbutyronitrile+`Comp.nitro-3-methyl-butane`+`Comp.cis-3-methylbutyraldoxime`+`Comp.trans-3-methylbutyraldoxime`,
                                         G.VAL=`Comp.cis-isobutyraldoxime`+`Comp.trans-isobutyraldoxime`,
                                         G.PHE=Comp.2phenylethanol+Comp.phenylacetonitrile+Comp.nitrophenylethane+Comp.phenylacetaldoxime,
                                         G.OCI=`Comp.b-myrcene`+`Comp.cis-b-ocimene`+`Comp.trans-b-ocimene`+`Comp.alpha-terpineol`,
                                         G.GER=Comp.citronellol+Comp.neral+Comp.geranial+Comp.nerol+Comp.geraniol,
                                         G.LIN=Comp.linalool+`Comp.cis-furanoid-linalool-oxide`+`Comp.trans-furanoid-linalool-oxide`+`Comp.pyran-lin-oxide-ketone`+`Comp.cis-pyranoid-linalool-oxide`+`Comp.trans-pyranoid-linalool-oxide`,
                                         G.CAR=`Comp.beta-caryophyllene`+`Comp.alpha-humulene`+`Comp.caryophyllene-oxide`,
                                         G.SES=`Comp.beta-farnesene`+`Comp.Z-E-alpha-farnesene`+`Comp.E-E-alpha-farnesene`+`Comp.farnesene-epoxide`+Comp.farnesol+Comp.nerolidol+Comp.isophytol)

ER_f_mass_group_data <- ER_f_mass_groups %>% filter(Type=="Yes") %>%  select(starts_with("G."))

ER_f_mass_group_data <- ER_f_mass_group_data %>% slice(.,-c(36,44)) 
ER_f_mass_groups <- ER_f_mass_groups %>% slice(.,-c(36,44)) %>% filter(Type=="Yes")

Arizona <- ER_f_mass_groups %>% filter(Population=="Arizona") %>%  select(starts_with("G."))
Zion <- ER_f_mass_groups %>% filter(Population=="Zion") %>%  select(starts_with("G."))
Inyo <- ER_f_mass_groups %>% filter(Population=="Inyo") %>%  select(starts_with("G."))
Logan <- ER_f_mass_groups %>% filter(Population=="Logan") %>%  select(starts_with("G."))
Idaho <- ER_f_mass_groups %>% filter(Population=="Idaho") %>%  select(starts_with("G."))

cormat.all <- round(cor(ER_f_mass_group_data),2)
melted_cormat.all <- melt(cormat.all)
upper_tri.all <- get_upper_tri(cormat.all)
# Melt the correlation matrix
melted_cormat.all <- melt(upper_tri.all, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.all <- ggplot(melted_cormat.all, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
    hjust = 1))+
 coord_fixed()+
ggtitle("All data") +xlab("") +ylab("")

cormat.AZ <- round(cor(Arizona),2)
melted_cormat.AZ <- melt(cormat.AZ)
upper_tri.AZ <- get_upper_tri(cormat.AZ)
# Melt the correlation matrix
melted_cormat.AZ <- melt(upper_tri.AZ, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.AZ <- ggplot(melted_cormat.AZ, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed()+
ggtitle("Arizona") +xlab("") +ylab("")

cormat.ZI <- round(cor(Zion),2)
melted_cormat.ZI <- melt(cormat.ZI)
upper_tri.ZI <- get_upper_tri(cormat.ZI)
# Melt the correlation matrix
melted_cormat.ZI <- melt(upper_tri.ZI, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.ZI <- ggplot(melted_cormat.ZI, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed()+
ggtitle("Zion") +xlab("") +ylab("")

cormat.IN <- round(cor(Inyo),2)
melted_cormat.IN <- melt(cormat.IN)
upper_tri.IN <- get_upper_tri(cormat.IN)
# Melt the correlation matrix
melted_cormat.IN <- melt(upper_tri.IN, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.IN <- ggplot(melted_cormat.IN, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed()+
ggtitle("Inyo") +xlab("") +ylab("")

cormat.LO <- round(cor(Logan),2)
melted_cormat.LO <- melt(cormat.LO)
upper_tri.LO <- get_upper_tri(cormat.LO)
# Melt the correlation matrix
melted_cormat.LO <- melt(upper_tri.LO, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.LO <- ggplot(melted_cormat.LO, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed()+
ggtitle("Logan") +xlab("") +ylab("")

cormat.ID <- round(cor(Idaho),2)
melted_cormat.ID <- melt(cormat.ID)
upper_tri.ID <- get_upper_tri(cormat.ID)
# Melt the correlation matrix
melted_cormat.ID <- melt(upper_tri.ID, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.ID <- ggplot(melted_cormat.ID, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed()+
ggtitle("Idaho") +xlab("") +ylab("")

ggarrange(ggheatmap.all, ggheatmap.AZ, ggheatmap.IN, ggheatmap.ZI, ggheatmap.LO, ggheatmap.ID, nrow=2, ncol=3, common.legend = TRUE, legend = "bottom")

```

### Heatmaps of morphology

These are sample sizes for morphology when we are just using the first flower. These values are generally smaller than the scent sample sizes, because a lot of flowers are missing one or more morphology measurements (even after dropping leaf number and leaf length, which were recorded very infrequently), and we can't include a sample in the correlation matrix if it has one or more NAs.

Population | *N*
---------- | ---
Total | 49
Arizona | 15
Idaho | 3
Inyo | 12
Logan | 12
Zion | 7

```{r, echo=FALSE, warning=FALSE, message=FALSE}

Arizona <- file3 %>% filter(Population=="Arizona" & Type=="Yes") %>% select(starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Zion <- file3 %>% filter(Population=="Zion" & Type=="Yes") %>% select(starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Inyo <- file3 %>% filter(Population=="Inyo" & Type=="Yes") %>% select(starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Logan <- file3 %>% filter(Population=="Logan" & Type=="Yes") %>% select(starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Idaho <- file3 %>% filter(Population=="Idaho" & Type=="Yes") %>% select(starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
morph <- file3 %>% filter(Population!="NA" &Type=="Yes") %>% select(starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()

labels <- c("Cor_D1", "Cor_D2", "Tube_F", "Stam_L", "Sty_L", "Hyp_L", "Ped_L", "Nect_C", "P_Sug")

cormat.all <- round(cor(morph),2)
melted_cormat.all <- melt(cormat.all)
upper_tri.all <- get_upper_tri(cormat.all)
# Melt the correlation matrix
melted_cormat.all <- melt(upper_tri.all, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.all <- ggplot(melted_cormat.all, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed()+scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("All data") +xlab("") +ylab("")

cormat.AZ <- round(cor(Arizona),2)
melted_cormat.AZ <- melt(cormat.AZ)
upper_tri.AZ <- get_upper_tri(cormat.AZ)
melted_cormat.AZ <- melt(upper_tri.AZ, na.rm = TRUE)
ggheatmap.AZ <- ggplot(melted_cormat.AZ, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Arizona") +xlab("") +ylab("")

cormat.ZI <- round(cor(Zion),2)
melted_cormat.ZI <- melt(cormat.ZI)
upper_tri.ZI <- get_upper_tri(cormat.ZI)
melted_cormat.ZI <- melt(upper_tri.ZI, na.rm = TRUE)
ggheatmap.ZI <- ggplot(melted_cormat.ZI, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Zion") +xlab("") +ylab("")

cormat.IN <- round(cor(Inyo),2)
melted_cormat.IN <- melt(cormat.IN)
upper_tri.IN <- get_upper_tri(cormat.IN)
melted_cormat.IN <- melt(upper_tri.IN, na.rm = TRUE)
ggheatmap.IN <- ggplot(melted_cormat.IN, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Inyo") +xlab("") +ylab("")

cormat.LO <- round(cor(Logan),2)
melted_cormat.LO <- melt(cormat.LO)
upper_tri.LO <- get_upper_tri(cormat.LO)
melted_cormat.LO <- melt(upper_tri.LO, na.rm = TRUE)
ggheatmap.LO <- ggplot(melted_cormat.LO, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Logan") +xlab("") +ylab("")

cormat.ID <- round(cor(Idaho),2)
melted_cormat.ID <- melt(cormat.ID)
upper_tri.ID <- get_upper_tri(cormat.ID)
melted_cormat.ID <- melt(upper_tri.ID, na.rm = TRUE)
ggheatmap.ID <- ggplot(melted_cormat.ID, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Idaho") +xlab("") +ylab("")

ggarrange(ggheatmap.all, ggheatmap.AZ, ggheatmap.IN, ggheatmap.ZI, ggheatmap.LO, ggheatmap.ID, nrow=2, ncol=3, common.legend = TRUE, legend = "bottom")
```


### Heatmaps of morphology & scent by compound group


Population | *N*
---------- | ---
Total | 46
Arizona | 15
Idaho | 3
Inyo | 11
Logan | 12
Zion | 5

```{r, echo=FALSE, warning=FALSE, message=FALSE}
ER_f_mass_group_data <- ER_f_mass_groups %>% select(starts_with("G."), Sample_ID)

morph <- file3 %>% filter(Population!="NA" &Type=="Yes")

scent_morph <- full_join(ER_f_mass_group_data, morph) %>% filter(Population!="NA") %>% filter(G.ILE!="NA")

Arizona <- scent_morph %>% filter(Population=="Arizona") %>%  select(starts_with("G."), starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Zion <- scent_morph %>% filter(Population=="Zion") %>%  select(starts_with("G."), starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Inyo <- scent_morph %>% filter(Population=="Inyo") %>%  select(starts_with("G."), starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Logan <- scent_morph %>% filter(Population=="Logan") %>%  select(starts_with("G."), starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()
Idaho <- scent_morph %>% filter(Population=="Idaho") %>%  select(starts_with("G."), starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()

scent_morph <- scent_morph %>% select(starts_with("G."), starts_with("M.")) %>% select(-"M.Leaf_Number", -"M.Leaf_Length") %>% drop_na()

labels <- c("G.ILE", "G.LEU","G.VAL","G.PHE","G.OCI","G.GER","G.LIN","G.CAR","G.SES", "Cor_D1", "Cor_D2", "Tube_F", "Stam_L", "Sty_L", "Hyp_L", "Ped_L", "Nect_C", "P_Sug")

cormat.all <- round(cor(scent_morph),2)
melted_cormat.all <- melt(cormat.all)
upper_tri.all <- get_upper_tri(cormat.all)
# Melt the correlation matrix
melted_cormat.all <- melt(upper_tri.all, na.rm = TRUE)
# Create a ggheatmap
ggheatmap.all <- ggplot(melted_cormat.all, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
  theme(axis.text.y = element_text(size =6))+
 theme(axis.text.x = element_text(angle = 90, vjust = 1, size = 6, 
     hjust = 1))+
 coord_fixed()+scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("All data") +xlab("") +ylab("")

cormat.AZ <- round(cor(Arizona),2)
melted_cormat.AZ <- melt(cormat.AZ)
upper_tri.AZ <- get_upper_tri(cormat.AZ)
melted_cormat.AZ <- melt(upper_tri.AZ, na.rm = TRUE)
ggheatmap.AZ <- ggplot(melted_cormat.AZ, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.y = element_text(size =6))+
 theme(axis.text.x = element_text(angle = 90, vjust = 1, size = 6, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Arizona") +xlab("") +ylab("")

cormat.ZI <- round(cor(Zion),2)
melted_cormat.ZI <- melt(cormat.ZI)
upper_tri.ZI <- get_upper_tri(cormat.ZI)
melted_cormat.ZI <- melt(upper_tri.ZI, na.rm = TRUE)
ggheatmap.ZI <- ggplot(melted_cormat.ZI, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.y = element_text(size =6))+
 theme(axis.text.x = element_text(angle = 90, vjust = 1, size = 6, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Zion") +xlab("") +ylab("")

cormat.IN <- round(cor(Inyo),2)
melted_cormat.IN <- melt(cormat.IN)
upper_tri.IN <- get_upper_tri(cormat.IN)
melted_cormat.IN <- melt(upper_tri.IN, na.rm = TRUE)
ggheatmap.IN <- ggplot(melted_cormat.IN, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.y = element_text(size =6))+
 theme(axis.text.x = element_text(angle = 90, vjust = 1, size = 6, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Inyo") +xlab("") +ylab("")

cormat.LO <- round(cor(Logan),2)
melted_cormat.LO <- melt(cormat.LO)
upper_tri.LO <- get_upper_tri(cormat.LO)
melted_cormat.LO <- melt(upper_tri.LO, na.rm = TRUE)
ggheatmap.LO <- ggplot(melted_cormat.LO, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.y = element_text(size =6))+
 theme(axis.text.x = element_text(angle = 90, vjust = 1, size = 6, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Logan") +xlab("") +ylab("")

cormat.ID <- round(cor(Idaho),2)
melted_cormat.ID <- melt(cormat.ID)
upper_tri.ID <- get_upper_tri(cormat.ID)
melted_cormat.ID <- melt(upper_tri.ID, na.rm = TRUE)
ggheatmap.ID <- ggplot(melted_cormat.ID, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.y = element_text(size =6))+
 theme(axis.text.x = element_text(angle = 90, vjust = 1, size = 6, 
     hjust = 1))+
 coord_fixed() +scale_x_discrete(labels=labels)+scale_y_discrete(labels=labels)+
ggtitle("Idaho") +xlab("") +ylab("")

ggarrange(ggheatmap.all, ggheatmap.AZ, ggheatmap.IN, ggheatmap.ZI, ggheatmap.LO, ggheatmap.ID, nrow=2, ncol=3, common.legend = TRUE, legend = "bottom")
```


